# å‰ç«¯è°ƒè¯•

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [å‰ç«¯è°ƒè¯•](#å‰ç«¯è°ƒè¯•)
  - [ä¸€. å¸¸ç”¨è°ƒè¯•å·¥å…·åŸç†](#ä¸€-å¸¸ç”¨è°ƒè¯•å·¥å…·åŸç†)
    - [1.1 Chrome DevTools åŸç†](#11-chrome-devtools-åŸç†)
      - [1.1.1 CDP](#111-cdp)
    - [1.2 VSCode Debugger åŸç†](#12-vscode-debugger-åŸç†)
    - [1.3 Vue/React DevTools](#13-vuereact-devtools)
    - [1.4 è°ƒè¯•å·¥å…·å››è¦ç´ ](#14-è°ƒè¯•å·¥å…·å››è¦ç´ )
    - [1.5 sourcemap](#15-sourcemap)
      - [1.5.1 ä»€ä¹ˆæ˜¯ sourcemap](#151-ä»€ä¹ˆæ˜¯-sourcemap)
      - [1.5.2 sourcemap çš„ç”Ÿæˆ](#152-sourcemap-çš„ç”Ÿæˆ)
      - [1.5.3 webpack çš„ sourcemap é…ç½®](#153-webpack-çš„-sourcemap-é…ç½®)
  - [äºŒ. VSCode ç½‘é¡µè°ƒè¯•](#äºŒ-vscode-ç½‘é¡µè°ƒè¯•)
    - [2.1 VSCode Chrome Debugger æ–­ç‚¹æ˜ å°„çš„åŸç†](#21-vscode-chrome-debugger-æ–­ç‚¹æ˜ å°„çš„åŸç†)
  - [ä¸‰. Node.js è°ƒè¯•](#ä¸‰-nodejs-è°ƒè¯•)
    - [3.1 ç”¨ Chrome DevTools è°ƒè¯• node ä»£ç ](#31-ç”¨-chrome-devtools-è°ƒè¯•-node-ä»£ç )
    - [3.2 ç”¨ VSCode Debugger è°ƒè¯• node ä»£ç ](#32-ç”¨-vscode-debugger-è°ƒè¯•-node-ä»£ç )
    - [3.3 node debugger çš„å†å²](#33-node-debugger-çš„å†å²)
    - [3.4 è°ƒè¯• npm scripts](#34-è°ƒè¯•-npm-scripts)
    - [3.5 è°ƒè¯•å‘½ä»¤è¡Œå·¥å…·](#35-è°ƒè¯•å‘½ä»¤è¡Œå·¥å…·)
  - [å››. è¿œç¨‹è°ƒè¯•ç§»åŠ¨ç«¯](#å››-è¿œç¨‹è°ƒè¯•ç§»åŠ¨ç«¯)
    - [4.1 è¿œç¨‹è°ƒè¯• android ç½‘é¡µ](#41-è¿œç¨‹è°ƒè¯•-android-ç½‘é¡µ)
    - [4.2 è¿œç¨‹è°ƒè¯• ios ç½‘é¡µ](#42-è¿œç¨‹è°ƒè¯•-ios-ç½‘é¡µ)
  - [äº”. Charles è°ƒè¯•](#äº”-charles-è°ƒè¯•)
    - [5.1 æ–­ç‚¹è°ƒè¯• https è¯·æ±‚](#51-æ–­ç‚¹è°ƒè¯•-https-è¯·æ±‚)

<!-- /code_chunk_output -->

## ä¸€. å¸¸ç”¨è°ƒè¯•å·¥å…·åŸç†

ä»£ç åœ¨æŸä¸ªå¹³å°è¿è¡Œï¼ŒæŠŠè¿è¡Œæ—¶çš„çŠ¶æ€é€šè¿‡æŸç§æ–¹å¼æš´éœ²å‡ºæ¥ï¼Œä¼ é€’ç»™å¼€å‘å·¥å…·åš UI çš„å±•ç¤ºå’Œäº¤äº’ï¼Œè¾…åŠ©å¼€å‘è€…æ’æŸ¥é—®é¢˜ã€æ¢³ç†æµç¨‹ã€äº†è§£ä»£ç è¿è¡ŒçŠ¶æ€ç­‰ï¼Œè¿™ä¸ªå°±æ˜¯è°ƒè¯•ã€‚

è¿™é‡Œçš„æŸä¸ªå¹³å°ï¼Œå¯ä»¥æ˜¯æµè§ˆå™¨ã€Node.jsã€Electronã€å°ç¨‹åºç­‰ä»»ä½•èƒ½æ‰§è¡Œ JS ä»£ç çš„å¹³å°ã€‚

æš´éœ²å‡ºçš„è¿è¡Œæ—¶çŠ¶æ€ï¼Œå¯èƒ½æ˜¯è°ƒç”¨æ ˆã€æ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæˆ–è€… DOM çš„ç»“æ„ï¼ŒReact ç»„ä»¶çš„çŠ¶æ€ç­‰ã€‚

æš´éœ²å‡ºè¿™äº›æ•°æ®çš„æ–¹å¼ä¸€èˆ¬æ˜¯é€šè¿‡åŸºäº WebSocket çš„è°ƒè¯•åè®®ï¼Œå½“ç„¶ä¹Ÿä¼šæœ‰åˆ«çš„æ–¹å¼ã€‚

### 1.1 Chrome DevTools åŸç†

ä¼ è¾“åè®®æ•°æ®çš„æ–¹å¼å«åš**ä¿¡é“**ï¼ˆmessage channelï¼‰ï¼Œæœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ Chrome DevTools åµŒå…¥åœ¨ Chrome é‡Œæ—¶ï¼Œä¸¤è€…é€šè¿‡å…¨å±€çš„å‡½æ•°é€šä¿¡ï¼›å½“ Chrome DevTools è¿œç¨‹è°ƒè¯•æŸä¸ªç›®æ ‡çš„ä»£ç æ—¶ï¼Œä¸¤è€…é€šè¿‡ WebSocket é€šä¿¡ã€‚

Chrome DevTools åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

- `backend`ï¼šbackend å’Œ Chrome é›†æˆï¼Œè´Ÿè´£æŠŠ Chrome çš„ç½‘é¡µè¿è¡Œæ—¶çŠ¶æ€é€šè¿‡è°ƒè¯•åè®®æš´éœ²å‡ºæ¥ã€‚backend å¯ä»¥æ˜¯ Chromiumï¼Œä¹Ÿå¯ä»¥æ˜¯ Node.js æˆ–è€… V8ï¼Œè¿™äº› JS çš„è¿è¡Œæ—¶éƒ½æ”¯æŒ CDP è°ƒè¯•åè®®ã€‚

- `frontend`ï¼šfrontend æ˜¯ç‹¬ç«‹çš„ï¼Œè´Ÿè´£å¯¹æ¥è°ƒè¯•åè®®ï¼Œåš UI çš„å±•ç¤ºå’Œäº¤äº’ã€‚

#### 1.1.1 CDP

Chrome DevTools backend å’Œ frontend ä¹‹é—´é€šè¿‡ WebSocket é€šä¿¡ï¼Œè®¾è®¡æœ‰ä¸“é—¨çš„è°ƒè¯•åè®® Chrome DevTools Protocolï¼Œç®€ç§° **CDP**ã€‚

![ChromeDevToolsè°ƒè¯•åŸç†](./image/ChromeDevTools%E8%B0%83%E8%AF%95%E5%8E%9F%E7%90%86.webp)

å› ä¸º Chrome DevTools è¢«è®¾è®¡æˆäº†å’Œ Chrome åˆ†ç¦»çš„æ¶æ„ï¼Œæ‰€ä»¥åªè¦å®ç°å¯¹æ¥ CDP åè®®çš„ ws æœåŠ¡ç«¯ï¼Œå°±å¯ä»¥ç”¨ Chrome DevTools æ¥è°ƒè¯•ï¼Œå› æ­¤ Chrome DevTools å¯ä»¥ç”¨æ¥è°ƒè¯•æµè§ˆå™¨çš„ç½‘é¡µã€è°ƒè¯• Node.jsï¼Œè°ƒè¯• Electron ç­‰ã€‚

è¿™ä¸ª CDP çš„è°ƒè¯•åè®®æ˜¯ json æ ¼å¼çš„ï¼Œå¯ä»¥åœ¨ Chrome DevTools çš„è®¾ç½® -> å®éªŒé€‰é¡¹é‡Œå¼€å¯ Protocol Monitorï¼Œç„¶ååœ¨ more tools é‡Œæ‰“å¼€ Protocol Monitor é¢æ¿ï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„ CDP åè®®çš„æ•°æ®äº¤äº’ï¼š

![ProtocolMonitor](./image/ProtocolMonitor.webp)

### 1.2 VSCode Debugger åŸç†

VSCode Debugger çš„åŸç†å’Œ Chrome DevTools å·®ä¸å¤šï¼Œä¹Ÿæ˜¯åˆ†ä¸º frontendã€backendã€è°ƒè¯•åè®®è¿™å‡ éƒ¨åˆ†ï¼Œåªä¸è¿‡å®ƒå¤šäº†ä¸€å±‚é€‚é…å™¨åè®®ã€‚

![VSCodeDebuggeråŸç†](./image/VSCodeDebugger%E5%8E%9F%E7%90%86.webp)

ä¸ºäº†èƒ½ç›´æ¥ç”¨ Chrome DevTools è°ƒè¯• Node.js ä»£ç ï¼ŒNode.js 6 ä»¥ä¸Šå°±ä½¿ç”¨ CDP ä½œä¸ºè°ƒè¯•åè®®äº†ï¼Œæ‰€ä»¥ VSCode Debugger è¦è°ƒè¯• Node.js ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªåè®®ã€‚

å› ä¸º VSCode ä¸æ˜¯ JS ä¸“ç”¨ç¼–è¾‘å™¨ï¼Œå®ƒå¯èƒ½ç”¨æ¥è°ƒè¯• Python ä»£ç ã€Rust ä»£ç ç­‰ç­‰ï¼Œä¸èƒ½å’ŒæŸä¸€ç§è¯­è¨€çš„è°ƒè¯•åè®®æ·±åº¦è€¦åˆï¼Œæ‰€ä»¥å¤šäº†ä¸€ä¸ªé€‚é…å™¨å±‚ Debug Adapter Protocolã€‚

![DebugAdapterProtocol](./image/DebugAdapterProtocol.webp)

è¿™æ · VSCode Debugger å°±å¯ä»¥ç”¨åŒä¸€å¥— UI å’Œé€»è¾‘æ¥è°ƒè¯•å„ç§è¯­è¨€çš„ä»£ç ï¼Œåªè¦å¯¹æ¥ä¸åŒçš„ Debug Adapter åšåè®®è½¬æ¢å³å¯ã€‚

è¿™æ ·è¿˜æœ‰å¦ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯åˆ«çš„ç¼–è¾‘å™¨ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ª Debug Adapter Protocol æ¥å®ç°è°ƒè¯•ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥å¤ç”¨ VSCode çš„å„ç§è¯­è¨€çš„ Debug Adapter äº†ã€‚

VSCode Debugger çš„ UI çš„éƒ¨åˆ†ç®—æ˜¯ frontendï¼Œè€Œè°ƒè¯•çš„ç›®æ ‡è¯­è¨€ç®—æ˜¯ backend éƒ¨åˆ†ï¼Œä¸­é—´ä¹Ÿæ˜¯é€šè¿‡ WebSocket ä¼ é€’è°ƒè¯•åè®®ã€‚

æ•´ä½“å’Œ Chrome DevTools çš„è°ƒè¯•åŸç†å·®ä¸å¤šï¼Œåªä¸è¿‡ä¸ºäº†æ”¯æŒ frontend çš„è·¨è¯­è¨€å¤ç”¨ï¼Œå¤šäº†ä¸€å±‚é€‚é…å™¨å±‚ã€‚

### 1.3 Vue/React DevTools

Vue DevTools æˆ–è€… React DevTools éƒ½æ˜¯ä»¥ Chrome æ’ä»¶ï¼ˆChrome Extensionï¼‰çš„å½¢å¼å­˜åœ¨çš„ï¼Œè¦ææ‡‚å®ƒä»¬çš„åŸç†å°±å¾—äº†è§£ Chrome æ’ä»¶çš„æœºåˆ¶ã€‚

**Chrome æ’ä»¶æœºåˆ¶**
Chrome æ’ä»¶ä¸­å¯ä»¥è®¿é—®ç½‘é¡µçš„ DOM çš„éƒ¨åˆ†å«åš **Content Script**ï¼Œéšé¡µé¢å¯åŠ¨è€Œç”Ÿæ•ˆï¼Œå¯ä»¥å†™ä¸€äº›æ“ä½œ DOM çš„é€»è¾‘ã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯åå°è¿è¡Œçš„ï¼Œå«åš **Background**ï¼Œæµè§ˆå™¨å¯åŠ¨å°±ç”Ÿæ•ˆäº†ï¼Œç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿ï¼Œå¯ä»¥åšä¸€äº›å¸¸é©»çš„é€»è¾‘ã€‚å¦‚æœæ˜¯æ‰©å±• DevTools çš„ Chrome æ’ä»¶ï¼Œé‚£è¿˜æœ‰ä¸€éƒ¨åˆ† DevTools Pageï¼Œæ˜¯åœ¨ DevTools é‡Œæ˜¾ç¤ºçš„é¡µé¢ï¼š

![Chromeæ’ä»¶æœºåˆ¶](./image/Chrome%E6%8F%92%E4%BB%B6%E6%9C%BA%E5%88%B6.webp)

Content Script éƒ¨åˆ†å¯ä»¥æ“ä½œ DOMï¼Œå¯ä»¥ç›‘å¬ DOM Eventã€‚

Background éƒ¨åˆ†å¯ä»¥è®¿é—® extension apiï¼Œå¯ä»¥å’Œ Content Script è¿˜æœ‰ DevTools Page é€šä¿¡ã€‚

DevTools Page éƒ¨åˆ†å¯ä»¥è®¿é—® devtools apiï¼Œå¯ä»¥å‘å½“å‰ window æ³¨å…¥ JS æ‰§è¡Œã€‚

è¿™å°±æ˜¯ Chrome æ’ä»¶çš„å¤§æ¦‚æ¶æ„ã€‚Vue DevTools å’Œ React DevTools å°±æ˜¯åŸºäºè¿™ä¸ªæ¶æ„æ¥å®ç°çš„è°ƒè¯•åŠŸèƒ½ã€‚

çœ‹ [Vue DevTools çš„æºç ç›®å½•](https://github.com/vuejs/devtools/tree/main/packages)ä¼šå‘ç°ï¼Œå®ƒä¹Ÿæ˜¯åˆ†ä¸º backend å’Œ frontend çš„

DevTools Page å¯ä»¥å‘é¡µé¢æ³¨å…¥ JS çš„ï¼Œé‚£å°±å¯ä»¥æ³¨å…¥ backend çš„ä»£ç ã€‚backend çš„ä»£ç æ‹¿åˆ° Vue ç»„ä»¶çš„ä¿¡æ¯ï¼Œé€šè¿‡ window message çš„æ–¹å¼ä¼ é€’ç»™ Backgroundã€‚Background å¯ä»¥å’Œ DevTools Page é€šä¿¡ï¼Œä»è€Œå®ç°æ¶ˆæ¯è½¬å‘ã€‚DevTools Page æ ¹æ®æ‹¿åˆ°çš„æ•°æ®ï¼Œæ¸²æŸ“ç»„ä»¶çš„ä¿¡æ¯ï¼Œå®ç°äº¤äº’åŠŸèƒ½ã€‚

![backendå’Œfrontendçš„è¿è¡Œä¸é€šä¿¡](./image/backend%E5%92%8Cfrontend%E7%9A%84%E8%BF%90%E8%A1%8C%E4%B8%8E%E9%80%9A%E4%BF%A1.webp)

### 1.4 è°ƒè¯•å·¥å…·å››è¦ç´ 

Chrome DevToolsã€VSCode Debuggerã€Vue/React DevToolsï¼Œéƒ½æœ‰ backend éƒ¨åˆ†è´Ÿè´£æ‹¿åˆ°è¿è¡Œæ—¶çš„ä¿¡æ¯ï¼Œæœ‰ frontend éƒ¨åˆ†è´Ÿè´£æ¸²æŸ“å’Œäº¤äº’ï¼Œä¹Ÿæœ‰è°ƒè¯•åè®®ç”¨æ¥è§„å®šä¸åŒæ•°æ®çš„æ ¼å¼ï¼Œè¿˜æœ‰ä¸åŒçš„ä¿¡é“ï¼Œæ¯”å¦‚ WebSocket ã€Chrome æ’ä»¶çš„ background è½¬å‘ç­‰ã€‚

**frontendã€backendã€è°ƒè¯•åè®®ã€ä¿¡é“ï¼Œè¿™æ˜¯è°ƒè¯•å·¥å…·çš„å››è¦ç´ **ã€‚

ä¸è¿‡ï¼Œä¸åŒçš„è°ƒè¯•å·¥å…·éƒ½ä¼šæœ‰ä¸åŒçš„è®¾è®¡ï¼Œæ¯”å¦‚ VSCode Debugger ä¸ºäº†è·¨è¯­è¨€å¤ç”¨ï¼Œå¤šäº†ä¸€å±‚ Debugger Adapterï¼ŒReact DevTools æœ‰ç‹¬ç«‹çš„ electron åº”ç”¨ï¼Œç”¨è‡ªå®šä¹‰è°ƒè¯•åè®®ï¼Œå¯ä»¥è°ƒè¯• React Native ä»£ç ã€‚

### 1.5 sourcemap

#### 1.5.1 ä»€ä¹ˆæ˜¯ sourcemap

**sourcemap æ˜¯é€šè¿‡ä¸€ä¸ªä¸ªè¡Œåˆ—å·çš„æ˜ å°„ï¼Œå…³è”ç¼–è¯‘åçš„ä»£ç å’Œæºç çš„ã€‚**ã€‚

æ¯”å¦‚ç¼–è¯‘åä»£ç çš„ç¬¬ 3 è¡Œç¬¬ 4 åˆ—ï¼Œå¯¹åº”ç€æºç é‡Œçš„ç¬¬ 8 è¡Œç¬¬ 5 åˆ—è¿™ç§ï¼Œè¿™å«åšä¸€ä¸ª **mapping**ã€‚sourcemap çš„æ ¼å¼å¦‚ä¸‹ï¼š

```js
{
ã€€version : 3,
ã€€file: "out.js",
ã€€sourceRoot : "",
ã€€sources: ["foo.js", "bar.js"],
ã€€names: ["a", "b"],
ã€€mappings: "AAgBC,SAAQ,CAAEA;AAAEA",
  sourcesContent: ['const a = 1; console.log(a)', 'const b = 2; console.log(b)']
}
```

file æ˜¯æ–‡ä»¶åï¼ŒsourceRoot æ˜¯æºç æ ¹ç›®å½•ï¼Œnames æ˜¯è½¬æ¢å‰çš„å˜é‡åï¼Œsources æ˜¯æºç æ–‡ä»¶ï¼ŒsourcesContent æ˜¯æ¯ä¸ª sources å¯¹åº”çš„æºç çš„å†…å®¹ï¼Œmappings å°±æ˜¯ä¸€ä¸ªä¸ªä½ç½®æ˜ å°„äº†ã€‚

å› ä¸ºå¯èƒ½ç¼–è¯‘äº§ç‰©æ˜¯å¤šä¸ªæºæ–‡ä»¶åˆå¹¶çš„ï¼Œæ¯”å¦‚æ‰“åŒ…ï¼Œä¸€ä¸ª bundle.js å°±å¯¹åº”äº† n ä¸ª sources æºæ–‡ä»¶ã€‚

**é‡ç‚¹æ˜¯ mappings éƒ¨åˆ†**ï¼šmappings éƒ¨åˆ†æ˜¯é€šè¿‡ `;` å’Œ `,` åˆ†éš”çš„ï¼š

```js
mappings: 'AAAAA,BBBBB;CCCCC';
```

ä¸€ä¸ªåˆ†å·å°±ä»£è¡¨ä¸€è¡Œï¼Œè¿™æ ·å°±å…å»äº†è¡Œçš„æ˜ å°„ã€‚ç„¶åæ¯ä¸€è¡Œå¯èƒ½æœ‰å¤šä¸ªä½ç½®çš„æ˜ å°„ï¼Œç”¨ `,` åˆ†éš”ã€‚

ä¸Šé¢çš„ mappings ä¸­æœ‰ AAAAA ä¸€å…±äº”ä½ï¼Œåˆ†åˆ«æœ‰ä¸åŒçš„å«ä¹‰ï¼š

- è½¬æ¢åä»£ç çš„ç¬¬å‡ åˆ—ï¼ˆè¡Œæ•°é€šè¿‡åˆ†å· ; æ¥ç¡®å®šï¼‰
- è½¬æ¢å‰çš„å“ªä¸ªæºç æ–‡ä»¶ï¼Œä¿å­˜åœ¨ sources é‡Œçš„ï¼Œè¿™é‡Œé€šè¿‡ä¸‹æ ‡ç´¢å¼•
- è½¬æ¢å‰çš„æºç çš„ç¬¬å‡ è¡Œ
- è½¬æ¢å‰çš„æºç çš„ç¬¬å‡ åˆ—
- è½¬æ¢å‰çš„æºç çš„å“ªä¸ªå˜é‡åï¼Œä¿å­˜åœ¨ names é‡Œçš„ï¼Œè¿™é‡Œé€šè¿‡ä¸‹æ ‡ç´¢å¼•

ç„¶åç»è¿‡ç¼–ç ä¹‹åï¼Œå°±æˆäº† AAAAA è¿™ç§ï¼Œè¿™ç§ç¼–ç æ–¹å¼å«åš **VLQ ç¼–ç **ã€‚

å„ç§è°ƒè¯•å·¥å…·ä¸€èˆ¬éƒ½æ”¯æŒ sourcemap çš„è§£æï¼Œåªè¦åœ¨æ–‡ä»¶æœ«å°¾åŠ ä¸Šè¿™æ ·ä¸€è¡Œï¼š

```js
//@ sourceMappingURL=/path/to/source.js.map
```

é™¤äº†è°ƒè¯•çš„æ—¶å€™ä¼šä½¿ç”¨ sourcemapï¼Œçº¿ä¸ŠæŠ¥é”™å®šä½æºç ä¹Ÿéœ€è¦ç”¨åˆ°ã€‚å¼€å‘æ—¶ä¼šä½¿ç”¨ sourcemap æ¥è°ƒè¯•ï¼Œä½†æ˜¯ç”Ÿäº§å¯ä¸ä¼šï¼Œä½†æ˜¯çº¿ä¸ŠæŠ¥é”™çš„æ—¶å€™ç¡®å®ä¹Ÿéœ€è¦å®šä½åˆ°æºç ï¼Œè¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯å•ç‹¬ä¸Šä¼  sourcemap åˆ°é”™è¯¯æ”¶é›†å¹³å°ã€‚

æ¯”å¦‚ sentry å°±æä¾›äº†ä¸€ä¸ª [@sentry/webpack-plugin](https://github.com/getsentry/sentry-webpack-plugin) æ”¯æŒåœ¨æ‰“åŒ…å®ŒæˆåæŠŠ sourcemap è‡ªåŠ¨ä¸Šä¼ åˆ° sentry åå°ï¼Œç„¶åæŠŠæœ¬åœ° sourcemap åˆ æ‰ã€‚è¿˜æä¾›äº† [@sentry/cli](https://github.com/getsentry/sentry-cli) è®©ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨ä¸Šä¼ ã€‚

sourcemap åªæ˜¯ä½ç½®çš„æ˜ å°„ï¼Œå¯ä»¥ç”¨åœ¨ä»»ä½•ä»£ç ä¸Šï¼Œæ¯”å¦‚ JSã€TSã€CSS ç­‰ï¼Œè€Œä¸” TS çš„ç±»å‹ä¹Ÿæ”¯æŒ sourcemapï¼š

```json
{
  "compilerOptions": {
    "sourceMap": true,
    "outDir": "./out",
    "declaration": true,
    "declarationMap": true
  }
}
```

æŒ‡å®šäº† declaration ä¼šç”Ÿæˆ d.ts çš„å£°æ˜æ–‡ä»¶ï¼Œè¿˜å¯ä»¥æŒ‡å®š declarationMap æ¥ç”Ÿæˆ sourcemapã€‚è¿™æ ·åœ¨ VSCode é‡Œå°±å¯ä»¥ç›´æ¥ç‚¹å‡»æŸä¸ªç±»å‹æ¥è·³è½¬åˆ°æºç é‡Œå¯¹åº”çš„åœ°æ–¹äº†ã€‚è¿™ä¹Ÿç®— sourcemap åº”ç”¨çš„å¦ä¸€ä¸ªåœºæ™¯ï¼Œ_ç”¨äºç”Ÿæˆçš„ç±»å‹å’Œæºç ä¸­å®šä¹‰çš„å…³è”_ã€‚

#### 1.5.2 sourcemap çš„ç”Ÿæˆ

ç¼–è¯‘å·¥å…·åœ¨ç”Ÿæˆä»£ç çš„æ—¶å€™ä¹Ÿä¼šç”Ÿæˆ sourcemapï¼š

![sourcemap çš„ç”Ÿæˆ](./image/sourcemap%20%E7%9A%84%E7%94%9F%E6%88%90.webp)

sourcemap å°±æ˜¯ç”±ä¸€ä¸ªä¸ªä½ç½®çš„æ˜ å°„ç»„æˆçš„ï¼Œå…³é”®å°±æ˜¯è¦çŸ¥é“æºç çš„å“ªä¸ªä½ç½®å¯¹åº”åˆ°äº†ç¼–è¯‘åä»£ç çš„å“ªä¸ªä½ç½®ï¼šé€šè¿‡ [astexplorer.net](https://astexplorer.net/#/gist/19042bfa06784d0e1b2dcb2ecd3559d5/50898c658d8129dbe520cc515af169331082036b) å¯ä»¥çœ‹åˆ°ï¼ŒAST ä¸­ä¿ç•™äº†æºç ä¸­çš„ä½ç½®ï¼Œè¿™æ˜¯ parser åœ¨ parse æºç çš„æ—¶å€™è®°å½•çš„ã€‚

![ASTä¸­çš„æ˜ å°„](./image/AST%E4%B8%AD%E7%9A%84%E6%98%A0%E5%B0%84.webp)

ç„¶åè¿›è¡Œ AST çš„å„ç§è½¬æ¢ä¹‹åä¼šæ‰“å°æˆç›®æ ‡ä»£ç ï¼Œæ‰“å°çš„æ—¶å€™æ˜¯ä¸€è¡Œè¡Œä¸€åˆ—åˆ—çš„æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œè¿™æ—¶å€™å°±æœ‰äº†ç›®æ ‡ä»£ç ä¸­çš„ä½ç½®ã€‚

```ts
export function ConditionaLExpression(node: Object) {
  this.print(node.test, node);
  this.space();
  this.token('?');
  this.space();
  this.print(node.consequent, node);
  this.space();
  this.token(':');
  this.space();
  this.print(node.alternate, node);
}
```

è¿™ä¸¤ä¸ªä½ç½®ä¸€å…³è”ï¼Œå°±æ˜¯ä¸€ä¸ª mappingã€‚

![sourcemapçš„ç”Ÿæˆè¿‡ç¨‹](./image/sourcemap%E7%9A%84%E7%94%9F%E6%88%90%E8%BF%87%E7%A8%8B.webp)

è¿™æ ·å°±ç”Ÿæˆäº† sourcemapã€‚å½“ç„¶ sourcemap æœ‰å¯¹åº”çš„æ ¼å¼å’Œç¼–ç ï¼Œè‡ªå·±ç”Ÿæˆè¿˜æ˜¯æŒºéº»çƒ¦çš„ï¼Œä¸€èˆ¬ä¼šç”¨ [source-map](https://github.com/mozilla/source-map) è¿™ä¸ªåŒ…ï¼šsource-map å¯ä»¥ç”¨äºç”Ÿæˆå’Œè§£æ sourcemapï¼Œå®ƒæš´éœ²äº† SourceMapConsumerã€SourceMapGeneratorã€SourceNode 3 ä¸ªç±»ï¼Œåˆ†åˆ«ç”¨äºæ¶ˆè´¹ sourcemapã€ç”Ÿæˆ sourcemapã€åˆ›å»ºæºç èŠ‚ç‚¹ã€‚

ç”Ÿæˆ sourcemap çš„æµç¨‹æ˜¯ï¼š

1. åˆ›å»ºä¸€ä¸ª SourceMapGenerator å¯¹è±¡
2. é€šè¿‡ addMapping æ–¹æ³•æ·»åŠ ä¸€ä¸ªæ˜ å°„
3. é€šè¿‡ toString è½¬ä¸º sourcemap å­—ç¬¦ä¸²

```js
let map = new SourceMapGenerator({
  file: 'source-mapped.js'
});

map.addMapping({
  generated: {
    line: 10,
    column: 35
  },
  source: 'foo.js',
  original: {
    line: 33,
    column: 2
  },
  name: 'christopher'
});

console.log(map.toString());
// '{"version":3,"file":"source-mapped.js",
//   "sources":["foo.js"],"names":["christopher"],"mappings":";;;;;;;;;mCAgCEA"}'
```

æ¶ˆè´¹ sourcemap ç”¨ `SourceMapConsumer` çš„ apiã€‚å¯ä»¥è°ƒç”¨ `originalPositionFor` å’Œ `generatedPositionFor` åˆ†åˆ«ç”¨ç›®æ ‡ä»£ç ä½ç½®æŸ¥æºç ä½ç½®å’Œç”¨æºç ä½ç½®æŸ¥ç›®æ ‡ä»£ç ä½ç½®ã€‚è¿˜å¯ä»¥é€šè¿‡ `eachMapping` éå†æ‰€æœ‰ mappingï¼Œå¯¹æ¯ä¸ªè¿›è¡Œå¤„ç†ã€‚

```js
const rawSourceMap = {
  version: 3,
  file: 'min.js',
  names: ['bar', 'baz', 'n'],
  sources: ['one.js', 'two.js'],
  sourceRoot: 'http://example.com/www/js/',
  mappings: 'CAAC,IAAI,IAAM,SAAUA,GAClB,OAAOC,IAAID;CCDb,IAAI,IAAM,SAAUE,GAClB,OAAOA'
};

const whatever = await SourceMapConsumer.with(rawSourceMap, null, consumer => {
  // ç›®æ ‡ä»£ç ä½ç½®æŸ¥è¯¢æºç ä½ç½®
  consumer.originalPositionFor({
    line: 2,
    column: 28
  });
  // { source: 'http://example.com/www/js/two.js',
  //   line: 2,
  //   column: 10,
  //   name: 'n' }

  // æºç ä½ç½®æŸ¥è¯¢ç›®æ ‡ä»£ç ä½ç½®
  consumer.generatedPositionFor({
    source: 'http://example.com/www/js/two.js',
    line: 2,
    column: 10
  });
  // { line: 2, column: 28 }

  // éå† mapping
  consumer.eachMapping(function (m) {
    // ...
  });

  return computeWhatever();
});
```

#### 1.5.3 webpack çš„ sourcemap é…ç½®

webpack å¯¹ sourcemap åšäº†å¾ˆå¤šå°è£…ã€‚æ¯”å¦‚ï¼š

- eval-nosources-cheap-module-source-map
- hidden-source-map

webpack çš„é…ç½®æ˜¯æœ‰è§„å¾‹çš„ã€‚å½“é…ç½®å†™é”™çš„æ—¶å€™ï¼Œwebpack ä¼šæç¤ºä¸€ä¸ªæ­£åˆ™ï¼š`^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$`ã€‚è¿™ä¸ªå°±æ˜¯é…ç½®çš„è§„å¾‹ï¼Œæ˜¯å‡ ç§åŸºç¡€é…ç½®çš„ç»„åˆã€‚ææ‡‚äº†æ¯ä¸€ç§åŸºç¡€é…ç½®ï¼Œæ¯”å¦‚ evalã€nosourcesã€cheapã€moduleï¼ŒæŒ‰ç…§è§„å¾‹ç»„åˆèµ·æ¥ï¼Œä¹Ÿå°±ææ‡‚äº†æ•´ä½“çš„é…ç½®ã€‚

- `eval`

  eval() å‡½æ•°ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å½“åš JS ä»£ç è¿›è¡Œæ‰§è¡Œã€‚ä½†æœ‰ä¸ªé—®é¢˜ï¼Œeval çš„ä»£ç æ‰“ä¸äº†æ–­ç‚¹ã€‚æ‰€ä»¥æµè§ˆå™¨æ”¯æŒäº†è¿™æ ·ä¸€ç§ç‰¹æ€§ï¼Œåªè¦åœ¨ eval ä»£ç çš„æœ€ååŠ ä¸Š `//# sourceURL=xxx`ï¼Œé‚£å°±ä¼šä»¥ xxx ä¸ºåå­—æŠŠè¿™æ®µä»£ç åŠ åˆ° sources é‡Œã€‚è¿™å°±å¯ä»¥æ‰“æ–­ç‚¹äº†ã€‚

  ```js
  eval(`
  function add(a,b){
    return a + b;
  }
  console.log(add(1, 2));
  //# sourceURL=å…‰.js`);
  // 3
  ```

  æ‰§è¡Œä»¥åï¼Œä¼šå‘ç° sources å¤šäº†å…‰.js çš„æ–‡ä»¶ï¼š

  ![eval()çš„sourceURL](<./image/eval()çš„sourceURL.webp>)

  å®ƒæ˜¯å¯ä»¥æ‰“æ–­ç‚¹çš„ï¼Œæ¯”å¦‚åœ¨ add é‡Œæ‰“ä¸ªæ–­ç‚¹ï¼Œç„¶åå†æ‰§è¡Œ evalã€‚

  é™¤äº†æŒ‡å®š source æ–‡ä»¶å¤–ï¼Œè¿˜å¯ä»¥è¿›ä¸€æ­¥æŒ‡å®š sourcemap æ¥æ˜ å°„åˆ°æºç ï¼š

  ```js
  eval(`
  function add(a,b){
    return a + b;
  }
  console.log(add(1, 2));
  //# sourceURL=å…‰.js
  //# sourceMappingURL= xxx`);
  ```

  è¿™æ ·ï¼ŒåŠ¨æ€ eval çš„ä»£ç ä¹Ÿèƒ½å…³è”åˆ°æºç ï¼Œå¹¶ä¸”èƒ½æ‰“æ–­ç‚¹äº†ã€‚

  webpack å°±åˆ©ç”¨äº† eval è¿™ä¸ªç‰¹æ€§æ¥ä¼˜åŒ–çš„ sourcemap ç”Ÿæˆçš„æ€§èƒ½ï¼Œæ¯”å¦‚å¯ä»¥æŒ‡å®š `devtool` ä¸º evalï¼š

  ```js
  module.exports = {
    devtool: 'eval'
  };
  ```

  ç”Ÿæˆçš„ä»£ç å°±æ˜¯æ¯ä¸ªæ¨¡å—éƒ½è¢« eval åŒ…è£¹çš„ï¼Œå¹¶ä¸”æœ‰ sourceUrl æ¥æŒ‡å®šæ–‡ä»¶åï¼š

  ![devtoolå€¼ä¸ºevalæ—¶ç”Ÿæˆçš„ä»£ç ](./image/devtool%E5%80%BC%E4%B8%BAeval%E6%97%B6%E7%94%9F%E6%88%90%E7%9A%84%E4%BB%A3%E7%A0%81.webp)

  è¿™æ ·åšæ¯”è¾ƒå¿«ï¼Œå› ä¸ºåªè¦æŒ‡å®šæ–‡ä»¶åå°±è¡Œï¼Œä¸ç”¨ç”Ÿæˆ sourcemapã€‚sourcemap çš„ç”Ÿæˆè¿˜æ˜¯å¾ˆæ…¢çš„ï¼Œè¦ä¸€ä¸ªä¸ª mapping çš„å¤„ç†ï¼Œåšç¼–ç ä¹‹ç±»çš„ã€‚

  æ¯ä¸ªæ¨¡å—çš„ä»£ç éƒ½è¢« eval åŒ…è£¹ï¼Œé‚£ä¹ˆæ‰§è¡Œçš„æ—¶å€™å°±ä¼šåœ¨ sources é‡Œç”Ÿæˆå¯¹åº”çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æ‰“æ–­ç‚¹äº†ã€‚ä¸è¿‡è¿™æ ·åªæ˜¯æŠŠæ¯ä¸ªæ¨¡å—çš„ä»£ç åˆ†äº†å‡ºå»ï¼Œå¹¶æ²¡æœ‰åšæºç çš„å…³è”ï¼Œå¦‚æœç›¸å…³è”æºç ï¼Œå¯ä»¥å†å¼€å¯ sourcemapï¼š

  ```js
  module.exports = {
    devtool: 'eval-source-map'
  };
  ```

  ä¼šå‘ç°ç”Ÿæˆçš„ä»£ç ä¹Ÿæ˜¯ç”¨ eval åŒ…è£¹çš„ï¼Œä½†é™¤äº† sourceUrl å¤–ï¼Œè¿˜æœ‰ sourceMappingUrlï¼š

  ![devtoolå€¼ä¸ºeval-source-mapæ—¶ç”Ÿæˆçš„ä»£ç ](./image/devtool%E5%80%BC%E4%B8%BAeval-source-map%E6%97%B6%E7%94%9F%E6%88%90%E7%9A%84%E4%BB%A3%E7%A0%81.webp)

  å†è¿è¡Œçš„æ—¶å€™é™¤äº† eval çš„ä»£ç ä¼šç”Ÿæˆæ–‡ä»¶æ”¾åœ¨ sources å¤–ï¼Œè¿˜ä¼šåš sourcemap çš„æ˜ å°„ï¼š

- `source-map`

  source-map çš„é…ç½®æ˜¯ç”Ÿæˆç‹¬ç«‹çš„ sourcemap æ–‡ä»¶ã€‚

  ```js
  module.exports = {
    devtool: 'source-map'
  };
  ```

  ![source-mapç”Ÿæˆçš„æ–‡ä»¶](./image/source-map%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6.webp)

  å¯ä»¥å…³è”ï¼Œä¹Ÿå¯ä»¥ä¸å…³è”ï¼Œæ¯”å¦‚åŠ ä¸Š hiddenï¼Œå°±æ˜¯ç”Ÿæˆ sourcemap ä½†æ˜¯ä¸å…³è”ï¼š

  ```js
  module.exports = {
    devtool: 'hidden-source-map'
  };
  ```

  ç”Ÿäº§ç¯å¢ƒå°±ä¸éœ€è¦å…³è” sourcemapï¼Œä½†æ˜¯å¯èƒ½è¦ç”Ÿæˆ sourcemap æ–‡ä»¶ï¼ŒæŠŠå®ƒä¸Šä¼ åˆ°é”™è¯¯ç®¡ç†å¹³å°ä¹‹ç±»çš„ï¼Œç”¨æ¥æ˜ å°„çº¿ä¸Šä»£ç æŠ¥é”™ä½ç½®åˆ°å¯¹åº”çš„æºç ã€‚

  æ­¤å¤–ï¼Œè¿˜å¯ä»¥é…ç½®æˆ inline çš„ï¼š

  ```js
  module.exports = {
    devtool: 'inline-source-map'
  };
  ```

  è¿™ä¸ªå°±æ˜¯é€šè¿‡ dataUrl çš„æ–¹å¼å†…è”åœ¨æ‰“åŒ…åçš„æ–‡ä»¶é‡Œï¼š

  ![inline-source-mapç”Ÿæˆçš„æ–‡ä»¶](./image/inline-source-map%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6.webp)

- `cheap`

  sourcemap æ…¢ä¸»è¦æ˜¯å¤„ç†æ˜ å°„æ¯”è¾ƒæ…¢ï¼Œå¾ˆå¤šæƒ…å†µä¸‹å¹¶ä¸éœ€è¦æ˜ å°„åˆ°æºç çš„è¡Œå’Œåˆ—ï¼Œåªè¦ç²¾ç¡®åˆ°è¡Œå°±è¡Œï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨ cheapã€‚

- `module`

  webpack ä¸­å¯¹ä¸€ä¸ªæ¨¡å—ä¼šè¿›è¡Œå¤šæ¬¡å¤„ç†ï¼Œæ¯”å¦‚ç»è¿‡ loader A åšä¸€æ¬¡è½¬æ¢ï¼Œå†ç”¨ loader B åšä¸€æ¬¡è½¬æ¢ï¼Œä¹‹åæ‰“åŒ…åˆ°ä¸€èµ·ã€‚æ¯æ¬¡è½¬æ¢éƒ½ä¼šç”Ÿæˆ sourcemapï¼Œé‚£ä¹Ÿå°±æ˜¯æœ‰å¤šä¸ª sourcemapï¼š

  ![webpackå¤šæ¬¡è½¬æ¢](./image/webpack%E5%A4%9A%E6%AC%A1%E8%BD%AC%E6%8D%A2.webp)

  é»˜è®¤ sourcemap åªæ˜¯èƒ½ä» bundle å…³è”åˆ°æ¨¡å—çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯åªå…³è”äº†æœ€åé‚£ä¸ª sourcemapã€‚

  ![é»˜è®¤sourcemapå…³è”ç›®æ ‡ä»£ç ](./image/%E9%BB%98%E8%AE%A4sourcemap%E5%85%B3%E8%81%94%E7%9B%AE%E6%A0%87%E4%BB%A3%E7%A0%81.webp)

  å¦‚æœæƒ³è°ƒè¯•æœ€åˆçš„æºç ï¼Œé‚£å°±æŠŠæ¯ä¸€æ¬¡çš„ loader çš„ sourcemap ä¹Ÿå…³è”èµ·æ¥ï¼Œè¿™å°±æ˜¯ module é…ç½®çš„ä½œç”¨ã€‚è¿™æ ·å°±èƒ½ä¸€æ¬¡æ€§æ˜ å°„å›æœ€åˆçš„æºç ï¼š

  ![sourcemapçš„module](./image/sourcemap%E7%9A%84module.webp)

- `nosources`

  sourcemap é‡Œæ˜¯æœ‰ sourceContent éƒ¨åˆ†çš„ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥æŠŠæºç è´´åœ¨è¿™é‡Œï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯æ ¹æ®æ–‡ä»¶è·¯å¾„æŸ¥ä¸åˆ°æ–‡ä»¶ä¹Ÿå¯ä»¥æ˜ å°„ï¼Œä½†è¿™æ ·ä¼šå¢åŠ  sourcemap çš„ä½“ç§¯ã€‚å¦‚æœç¡®å®šæ ¹æ®æ–‡ä»¶è·¯å¾„èƒ½æŸ¥æ‰¾åˆ°æºæ–‡ä»¶ï¼Œé‚£ä¸ç”Ÿæˆ sourceContent ä¹Ÿè¡Œã€‚

  æ¯”å¦‚ devtool é…ç½®ä¸º source-mapï¼Œç”Ÿæˆçš„ sourcemap æ˜¯è¿™æ ·çš„ï¼š

  ![sourcemapç”Ÿæˆçš„æ–‡ä»¶ä¸­æœ‰sourceContent](./image/sourcemap%E7%94%9F%E6%88%90%E7%9A%84%E6%96%87%E4%BB%B6%E4%B8%AD%E6%9C%89sourceContent.webp)

  å½“åŠ ä¸Š nosources ä¹‹åï¼Œç”Ÿæˆçš„ sourcemap å°±æ²¡æœ‰ sourceContent éƒ¨åˆ†äº†ï¼š

  ```js
  module.exports = {
    devtool: 'nosources-source-map'
  };
  ```

å¯ä»¥æ ¹æ®ä¸Šé¢çš„åŸºç¡€é…ç½®æ¥è‡ªç”±ç»„åˆï¼Œwebpack æ˜¯æŒ‰ç…§è¿™ä¸ªæ­£åˆ™æ¥æ ¡éªŒ devtool çš„ï¼š`^(inline-|hidden-|eval-)?(nosources-)?(cheap-(module-)?)?source-map$`ã€‚

webpack æœ‰è¿™æ ·ä¸€ä¸ªæ’ä»¶ [SourceMapDevToolPlugin](https://webpack.docschina.org/plugins/source-map-dev-tool-plugin)ï¼Œå®ƒæœ‰å¾ˆå¤š optionï¼Œæ¯”å¦‚ moduleã€columnsã€noSources ç­‰ï¼š

- `module = true (boolean)`ï¼šè¡¨ç¤º loader æ˜¯å¦ç”Ÿæˆ source mapã€‚
- `columns = true (boolean)`ï¼šè¡¨ç¤ºæ˜¯å¦åº”è¯¥ä½¿ç”¨ column mappingã€‚
- `noSources = false (boolean)`ï¼šé˜²æ­¢æºæ–‡ä»¶çš„å†…å®¹è¢«åŒ…å«åœ¨ source map ä¸­ã€‚

ç›¸å½“äºæ˜¯ devtool çš„å¦ä¸€ç§é…ç½®æ–¹å¼ï¼Œå¯ç”¨å®ƒéœ€è¦æŠŠ devtool è®¾ç½®ä¸º falseã€‚è€Œä¸”å®ƒå¯ä»¥æ§åˆ¶æ›´å¤šä¸œè¥¿ï¼Œæ¯”å¦‚ä¿®æ”¹ sourcemap çš„ url å’Œæ–‡ä»¶åç­‰ï¼š

```js
new webpack.SourceMapDevToolPlugin({
  append: '\n//# sourceMappingURL=https://example.com/sourcemap/[url]',
  filename: '[name].map'
});
```

å½“éœ€è¦åšæ›´å¤šçš„ sourcemap ç”Ÿæˆæ–¹å¼çš„æ§åˆ¶çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª webpack æ’ä»¶ã€‚

## äºŒ. VSCode ç½‘é¡µè°ƒè¯•

ç½‘é¡µè°ƒè¯•å°±æ˜¯æŠŠæµè§ˆå™¨è·‘èµ·æ¥ï¼Œè®¿é—®ç›®æ ‡ç½‘é¡µï¼Œè¿™æ—¶å€™ä¼šæœ‰ä¸€ä¸ª ws çš„è°ƒè¯•æœåŠ¡ï¼Œç”¨ frontend çš„ ws å®¢æˆ·ç«¯è¿æ¥ä¸Šè¿™ä¸ª ws æœåŠ¡ï¼Œå°±å¯ä»¥è¿›è¡Œè°ƒè¯•äº†ã€‚å…·ä½“[è°ƒè¯•çš®é…ç½®](/public_knowledge/VSCode/VisualStudioCode.md#32-launchjson-å±æ€§)ã€‚

![è°ƒè¯•åŸç†](./image/%E8%B0%83%E8%AF%95%E5%8E%9F%E7%90%86.webp)

VSCode çš„ Debugger ä¼šå¤šä¸€å±‚é€‚é…å™¨åè®®çš„è½¬æ¢ï¼Œä½†æ˜¯åŸç†å·®ä¸å¤šã€‚

### 2.1 VSCode Chrome Debugger æ–­ç‚¹æ˜ å°„çš„åŸç†

VSCode ä¼šè®°å½•åœ¨å“ªä¸ªæ–‡ä»¶å“ªè¡Œæ‰“äº†ä¸ª[æ–­ç‚¹](/public_knowledge/VSCode/VisualStudioCode.md#33-æ–­ç‚¹çš„ç§ç±»å’Œä½¿ç”¨)ã€‚åœ¨ breakpoints é‡Œå¯ä»¥çœ‹åˆ°ã€‚

ä»£ç ç»è¿‡ç¼–è¯‘æ‰“åŒ…ä¹‹åï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ª bundle.jsï¼Œç½‘é¡µé‡Œè¿è¡Œçš„å°±æ˜¯è¿™ä¸ª js æ–‡ä»¶ã€‚æ–­ç‚¹æœ€ç»ˆè¿˜æ˜¯åœ¨ä»£ç çš„è¿è¡Œæ—¶ï¼Œä¹Ÿå°±æ˜¯ç½‘é¡µé‡Œæ–­ä½çš„ï¼Œæ‰€ä»¥åœ¨ VSCode é‡Œæ‰“çš„æ–­ç‚¹ä¼šè¢«ä¼ é€’ç»™æµè§ˆå™¨ï¼Œé€šè¿‡ CDP è°ƒè¯•åè®®ã€‚

æœ¬åœ°æ‰“çš„æ–­ç‚¹æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯åŒ…å« ${workspaceFolder} çš„è·¯å¾„ï¼Œè€Œç½‘é¡µé‡Œæ ¹æœ¬æ²¡æœ‰è¿™ä¸ªè·¯å¾„ï¼Œå¯ä»¥æˆåŠŸæ˜¯å› ä¸ºæœ‰çš„æ–‡ä»¶æ˜¯å…³è”äº† sourcemapï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶æœ«å°¾çš„è¿™è¡Œæ³¨é‡Šï¼š

![å…³è”sourcemap](./image/%E5%85%B3%E8%81%94sourcemap.webp)

å®ƒä¼šæŠŠæ–‡ä»¶è·¯å¾„æ˜ å°„åˆ°æºç è·¯å¾„ã€‚å¦‚æœæ˜ å°„åˆ°çš„æºç è·¯å¾„ç›´æ¥å°±æ˜¯æœ¬åœ°çš„æ–‡ä»¶è·¯å¾„ï¼Œé‚£æ–­ç‚¹å°±ç”Ÿæ•ˆäº†ï¼š

![æ–­ç‚¹æ˜ å°„åŸç†](./image/%E6%96%AD%E7%82%B9%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86.webp)

vite çš„é¡¹ç›®ï¼Œsourcemap éƒ½æ˜¯è¿™ç§ç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥æ–­ç‚¹ç›´æ¥å°±ç”Ÿæ•ˆäº†ï¼š

![viteçš„sourcemap](./image/vite%E7%9A%84sourcemap.webp)

ä½†æ˜¯ webpack çš„é¡¹ç›®ï¼Œsourcemap åˆ°çš„è·¯å¾„ä¸æ˜¯ç»å¯¹è·¯å¾„ï¼Œè€Œæ˜¯è¿™ç§ï¼š

![webpack4çš„sourcemap](./image/webpack4%E7%9A%84sourcemap.webp)

æˆ–

![webpack5çš„sourcemap](./image/webpack5%E7%9A%84sourcemap.webp)

æ‰€ä»¥ VSCode Chrome Debugger æ”¯æŒäº† `sourceMapPathOverrides` çš„é…ç½®ï¼š

```json
{
  "sourceMapPathOverrides": {
    "meteor://ğŸ’»app/*": "${workspaceFolder}/*",
    "webpack:///./~/*": "${workspaceFolder}/node_modules/*",
    "webpack://?:*/*": "${workspaceFolder}/*"
  }
}
```

é»˜è®¤ç”Ÿæˆçš„ä¸‰ä¸ªé…ç½®ï¼Œæœ€åä¸€ä¸ªå°±æ˜¯æ˜ å°„ webpack è·¯å¾„çš„ï¼Œå…¶å®æ˜¯æŠŠä»¥ `${workspaceFolder}` å¼€å¤´çš„æœ¬åœ°è·¯å¾„æ˜ å°„æˆäº† webpack:// å¼€å¤´çš„è·¯å¾„ä¼ ç»™æµè§ˆå™¨ã€‚

![sourceMapPathOverridesæ˜ å°„](./image/sourceMapPathOverrides%E6%98%A0%E5%B0%84.webp)

è¿™æ ·å°±å’Œæµè§ˆå™¨é‡Œçš„ sourcemap åçš„æ–‡ä»¶è·¯å¾„å¯¹ä¸Šäº†ï¼Œé‚£æ–­ç‚¹ä¹Ÿå°±ç”Ÿæ•ˆäº†ã€‚

![æœ‰sourceMapPathOverridesçš„æ˜ å°„åŸç†](./image/%E6%9C%89sourceMapPathOverrides%E7%9A%84%E6%98%A0%E5%B0%84%E5%8E%9F%E7%90%86.webp)

å…·ä½“æ€ä¹ˆé…ï¼Œå¯ä»¥åŠ ä¸ª debugger çœ‹çœ‹ Chrome DevTools é‡Œæ˜¯ä»€ä¹ˆè·¯å¾„ï¼Œç„¶åæ˜ å°„åˆ°æœ¬åœ°çš„è·¯å¾„å°±è¡Œã€‚

ä½†ä¸Šé¢éƒ½æ˜¯æŠŠé¡¹ç›®æ ¹ç›®å½•æ˜ å°„åˆ° url çš„ / çš„ï¼Œæœ‰çš„æ—¶å€™æ˜ å°„çš„ä¸æ˜¯ /ï¼Œä¼šå‡ºç°è¿™ç§æƒ…å†µï¼š

```txt
mobile/js/webpack:/src/pages/user-center/index.tsx
```

è¿™å°±éœ€è¦ webRoot çš„é…ç½®äº†ï¼Œé»˜è®¤æ˜¯ `${workspaceFolder}`ï¼Œä¹Ÿå°±æ˜¯æŠŠé¡¹ç›®æ ¹ç›®å½•æ˜ å°„åˆ° url çš„ /ã€‚å¦‚æœå‡ºç°ä¸Šé¢çš„æƒ…å†µï¼Œè¯´æ˜è¦æŠŠ /mobile/js/ è¿™ä¸ªè·¯å¾„æ˜ å°„åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼š

```json
{
  "webRoot": "${workspaceFolder}/mobile/js/"
}
```

ç»¼ä¸Šï¼Œ**å¦‚æœ sourcemap åˆ°çš„æ–‡ä»¶è·¯å¾„ä¸æ˜¯æœ¬åœ°è·¯å¾„ï¼Œé‚£å°±æ˜ å°„ä¸åˆ°æœ¬åœ°æ–‡ä»¶ï¼Œä¼šå¯¼è‡´æ–­ç‚¹æ‰“ä¸ä¸Šï¼Œè¿™æ—¶å€™å¯ä»¥é…ç½® sourceMapPathOverridesã€‚å¦‚æœæ˜ å°„ä¹‹åè·¯å¾„å¼€å¤´å¤šäº†å‡ å±‚ç›®å½•ï¼Œé‚£å°±è¦é…ç½® webRoot**ã€‚

## ä¸‰. Node.js è°ƒè¯•

```js
const fs = require('fs/promises');

(async function () {
  const fileContent = await fs.readFile('./package.json', {
    encoding: 'utf-8'
  });

  await fs.writeFile('./package2.json', fileContent);
})();
```

node è¿è¡Œæ—¶åŠ ä¸ª --inspect-brk å‚æ•°ï¼Œä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ï¼š

```sh
node --inspect-brk ./index.js
```

--inspect æ˜¯ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨ï¼Œ--inspect-brk æ˜¯ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨å¹¶ä¸”åœ¨é¦–è¡Œæ–­ä½ã€‚

ç„¶åå°±ä¼šå‘ç°å®ƒæ‰“å°äº† ws çš„åœ°å€ï¼š

```sh
Debugger listening on ws://127.0.0.1:9229/42cba635-89f0-4d11-8057-073c8bcf467d
```

è¿™å°±æ˜¯è°ƒè¯•çš„æœåŠ¡ç«¯ã€‚æ¥ä¸‹æ¥æ‰¾ä¸ªå¯¹æ¥å®ƒçš„è°ƒè¯•åè®®çš„å®¢æˆ·ç«¯è¿ä¸Šå°±è¡Œäº†ã€‚

### 3.1 ç”¨ Chrome DevTools è°ƒè¯• node ä»£ç 

æ‰“å¼€ `chrome://inspect/#devices`ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æ‰€æœ‰å¯ä»¥è°ƒè¯•çš„ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯ ws æœåŠ¡ç«¯ï¼š

![Chrome-devices](./image/Chrome-devices.webp)

ä¼šå‘ç°è¿™é‡Œåˆ—å‡ºäº†å¯åŠ¨çš„ node è„šæœ¬ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç½‘ç»œç«¯å£é‡ŒåŠ ä¸Šäº† node çš„ ws è°ƒè¯•æœåŠ¡çš„ç«¯å£ï¼š

![Devices-network](./image/Devices-network.webp)

node è°ƒè¯•æœåŠ¡é»˜è®¤æ˜¯è·‘åœ¨ 9229 ç«¯å£ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥æ¢ï¼š

```sh
node --inspect-brk=8888 ./index.js
```

åªè¦æŠŠå®ƒçš„ç«¯å£åŠ å…¥åˆ°é…ç½®é‡Œå°±å¯ä»¥äº†ã€‚ç‚¹å‡» inspect å°±å¯ä»¥è°ƒè¯•è¿™ä¸ª node è„šæœ¬äº†ï¼š

![ç‚¹å‡»inspectè°ƒè¯•nodeè„šæœ¬](./image/%E7%82%B9%E5%87%BBinspect%E8%B0%83%E8%AF%95node%E8%84%9A%E6%9C%AC.webp)

### 3.2 ç”¨ VSCode Debugger è°ƒè¯• node ä»£ç 

åœ¨ vscode çš„ launch.json æ–‡ä»¶é‡Œæ·»åŠ ä¸€ä¸ª node ç±»å‹çš„ attach çš„[è°ƒè¯•é…ç½®](/public_knowledge/VSCode/VisualStudioCode.md)ï¼š

```json
{
  "name": "Attach",
  "port": 9229,
  "request": "attach",
  "skipFiles": ["<node_internals>/**"],
  "type": "node"
}
```

ç„¶åç‚¹å‡» debug å¯åŠ¨ï¼ŒVSCode Debugger å°±ä¼šè¿æ¥ä¸Š 8888 çš„è°ƒè¯•ç«¯å£å¼€å§‹è°ƒè¯•ï¼Œå¯ä»¥è¾¹è°ƒè¯•è¾¹ä¿®æ”¹ä»£ç ã€‚

è¿˜å¯ä»¥åœ¨åˆ›å»ºè°ƒè¯•é…ç½®çš„æ—¶å€™é€‰æ‹© launch programï¼ŒæŒ‡å®š program çš„è·¯å¾„ï¼š

```json
{
  "name": "Launch Program",
  "type": "node",
  "request": "launch",
  "skipFiles": ["<node_internals>/**"],
  "program": "${workspaceFolder}/index.js"
}
```

VSCode Debugger å°±ä¼šè‡ªåŠ¨ä»¥è°ƒè¯•æ¨¡å¼è·‘è¿™ä¸ª node è„šæœ¬ï¼Œå¹¶ä¸”è‡ªåŠ¨ attach ä¸Šã€‚

å¦‚æœæƒ³é¦–è¡Œæ–­ä½ï¼Œå¯ä»¥åŠ ä¸€ä¸ª [stopOnEntry](/public_knowledge/VSCode/VisualStudioCode.md#32-launchjson-å±æ€§) çš„é…ç½®ã€‚

VSCode Debugger å’Œ Chrome DevTools éƒ½å¯ä»¥è°ƒè¯• node ä»£ç ï¼Œæ˜¯å› ä¸ºéƒ½å¯¹æ¥äº† node çš„ CDP è°ƒè¯•åè®®ï¼Œåªæ˜¯å®ç°äº†å„è‡ªçš„ UIï¼š

![VSCodeå’ŒChromeå¯¹æ¥Nodeè°ƒè¯•åè®®](./image/VSCode%E5%92%8CChrome%E5%AF%B9%E6%8E%A5Node%E8%B0%83%E8%AF%95%E5%8D%8F%E8%AE%AE.webp)

### 3.3 node debugger çš„å†å²

Node.js æ˜¯åŸºäº V8 çš„ï¼ŒV8 æœ¬èº«æœ‰è°ƒè¯•åè®® V8 Debug Protocolï¼Œæ‰€ä»¥ Node.js æœ€æ—©çš„è°ƒè¯•åè®®ä¹Ÿå°±æ˜¯ V8 Debug Protocolã€‚

é€šè¿‡ node debug æ¥è·‘ js æ–‡ä»¶ï¼Œä¼šåœ¨é¦–è¡Œæ–­ä½ï¼š

```sh
node debug./test.js
```

ç„¶åå¯ä»¥é€šè¿‡ runã€contã€nextã€step ç­‰å‘½ä»¤æ¥å®ç°å•æ­¥è°ƒè¯•ï¼Œé€šè¿‡ backtrace æ‰“å°è°ƒç”¨æ ˆï¼Œé€šè¿‡ setBreakPoint ç­‰è®¾ç½®æ–­ç‚¹ã€‚

è™½ç„¶è¯¥æœ‰çš„è°ƒè¯•åŠŸèƒ½éƒ½æœ‰ï¼Œä½†æ˜¯è¿™æ ·è°ƒè¯•è¿˜æ˜¯æ¯”è¾ƒè´¹åŠ²çš„ã€‚å½“æ—¶ Node å°±ç„å‡†äº† Chrome DevToolsï¼Œå®ƒçš„è°ƒè¯• UI å°±å¾ˆä¸é”™ã€‚

ç”±äº Chrome DevTools çš„è°ƒè¯•åè®®æ˜¯ Chrome DevTools Protocolï¼Œå’Œ V8 Debug Protocol æœ‰äº›å·®è·ï¼Œæ‰€ä»¥ Node åŠ äº†ä¸€ä¸ªä¸­é—´çš„æœåŠ¡æ¥åšè½¬æ¢ï¼š

![node-inspector](./image/node-inspector.webp)

è¿™ä¸ªæœåŠ¡æ˜¯ node-inspector è¿™ä¸ªåŒ…æä¾›çš„ã€‚æ‰€ä»¥å½“æ—¶ node debug æœåŠ¡è·‘èµ·æ¥ä¹‹åï¼Œè¿˜è¦è¦å†è·‘ä¸€ä¸ª node-inspector æœåŠ¡ï¼Œè¿™æ ·æ‰èƒ½ç”¨ chrome devtools æ¥è°ƒè¯• Node.js ä»£ç ã€‚

åæ¥ç»´æŠ¤ Node.js çš„é‚£äº›äººè§‰å¾—è¿™æ ·ä¹Ÿå¤ªéº»çƒ¦äº†ï¼Œè¦ä¸è®© Node.js æä¾›çš„è°ƒè¯•åè®®å°±ç›´æ¥å°±æ˜¯å…¼å®¹ Chrome Devtools Protocol çš„å§ã€‚å½“æ—¶å°±æœ‰äº†ä¸€ä¸ª prï¼ŒæŠŠ v8 inspector é›†æˆåˆ° Node.js ä¸­ã€‚

è¿™ä¸ª v8 inspector å°±æ˜¯ä» chrome çš„å†…æ ¸ blink é‡Œå‰¥ç¦»å‡ºæ¥çš„è®© v8 æ”¯æŒ chrome devtools protocol çš„éƒ¨åˆ†ã€‚å¾ˆæ˜æ˜¾è¿™éœ€è¦ v8 å›¢é˜Ÿçš„é…åˆï¼Œæ‰€ä»¥è¯´ Node.js çš„å‘å±•è¿˜æ˜¯å¾ˆä¾èµ– v8 å›¢é˜Ÿçš„æ”¯æŒçš„ã€‚ä¹‹å Node.js å°±åœ¨ v6.3 ä¸­åŠ å…¥äº†è¿™ä¸ªåŠŸèƒ½ã€‚

å¹¶ä¸”åœ¨æˆç†Ÿä¹‹åå»æ‰äº†å¯¹ v8 debug protocol çš„æ”¯æŒï¼Œä¹Ÿå°±æ˜¯åºŸå¼ƒäº† node debug å‘½ä»¤ï¼Œæ”¹ä¸ºäº† node inspectã€‚

å¯åŠ¨ ws è°ƒè¯•æœåŠ¡çš„æ–¹å¼å°±æ˜¯ node --inspect æˆ–è€… node --inspect-brkã€‚å½“ç„¶ï¼Œä¹‹å‰ä½œä¸ºä¸¤ä¸ªåè®®çš„ä¸­è½¬çš„æœåŠ¡ node-inspector ä¹Ÿå°±é€€å‡ºäº†å†å²èˆå°ã€‚

æ‰€ä»¥ä»Šå¤©ï¼Œå¯ä»¥è½»æ˜“çš„ç”¨ Chrome DevTools æ¥è°ƒè¯• Node.js ä»£ç ã€‚

**è°ƒè¯•çš„åŸç†å°±æ˜¯ ws å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„é€šä¿¡ï¼Œç„¶ååŸºäºè°ƒè¯•åè®®æ¥å®Œæˆä¸åŒçš„åŠŸèƒ½**ã€‚Node.js æ˜¯è¿™æ ·ï¼Œå…¶ä»–è¯­è¨€ä¹Ÿæ˜¯è¿™æ ·ã€‚

VSCode æ˜¯ä¸€ä¸ªé€šç”¨çš„ç¼–è¾‘å™¨ï¼Œæ˜¯è¦æ”¯æŒå¤šç§è¯­è¨€çš„ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„è°ƒè¯• UI è¦æ”¯æŒå¤šç§è°ƒè¯•åè®®ã€‚VSCode åŠ äº†ä¸€ä¸ªä¸­é—´å±‚ï¼ŒVSCode çš„è°ƒè¯• UI åªè¦æ”¯æŒè¿™ä¸ªä¸­é—´çš„è°ƒè¯•åè®®å°±å¯ä»¥äº†ï¼Œå…¶ä½™çš„è°ƒè¯•åè®®é€‚é…åˆ°è¿™ä¸ªè°ƒè¯•åè®®ä¸Šæ¥ï¼š

![debugger adapter protocol](./image/debugger%20adapter%20protocol.webp)

è¿™å°±æ˜¯ DAP åè®®ï¼Œdebugger adapter protocolã€‚

Node.js åœ¨æŠŠè°ƒè¯•å·¥å…·çš„åè®®æ¢æˆ Chrome Devtools Protocol ä¹‹åï¼Œåªè¦å®ç°ä¸ª DAP çš„ adapter å°±å¯ä»¥å¯¹æ¥åˆ° VSCode çš„è°ƒè¯•å·¥å…·äº†ã€‚

### 3.4 è°ƒè¯• npm scripts

å‘½ä»¤è¡Œå·¥å…·çš„ package.json é‡Œéƒ½ä¼šæœ‰ä¸ª `bin` å­—æ®µï¼Œæ¥æŒ‡å®šå„ä¸ªå†…éƒ¨å‘½ä»¤å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®ï¼š

```json
{
  "bin": {
    "webpack": "bin/webpack.js"
  }
}
```

npm install è¿™ä¸ªåŒ…ä»¥åï¼Œå°±ä¼šæ”¾åˆ° node_modules/.bin ç›®å½•ä¸‹ï¼Œå¯ä»¥ç”¨ npx æ¥è·‘ï¼Œæ¯”å¦‚ npx xxï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯æ‰§è¡Œ node_modules/.bin ä¸‹çš„æœ¬åœ°å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ä¼šä» npm ä¸‹è½½ç„¶åæ‰§è¡Œã€‚

æœ€å¸¸ç”¨çš„è¿˜æ˜¯æ”¾åˆ° npm scripts é‡Œï¼š

```json
{
  "scripts": {
    "lint": "eslint --ext .js,.ts frontend"
  }
}
```

è¿™æ ·å°±ç›´æ¥ npm run xxx è·‘å°±è¡Œäº†ã€‚npm scripts æœ¬è´¨ä¸Šè¿˜æ˜¯ç”¨ node æ¥è·‘è¿™äº› script ä»£ç ï¼Œæ‰€ä»¥è°ƒè¯•å®ƒä»¬å’Œè°ƒè¯•å…¶ä»– node ä»£ç æ²¡å•¥åŒºåˆ«ã€‚

ä¹Ÿå°±æ˜¯å¯ä»¥è¿™æ ·è·‘ï¼šåœ¨ .vscode/launch.json çš„è°ƒè¯•æ–‡ä»¶é‡Œï¼Œé€‰æ‹© node çš„ launch programï¼Œç”¨ node æ‰§è¡Œ node_modules/.bin ä¸‹çš„æ–‡ä»¶ï¼Œä¼ å…¥å‚æ•°å³å¯ï¼š

```json
{
  "name": "Launch Program",
  "program": "${workspaceFolder}/node_modules/.bin/eslint",
  "args": ["--ext", ".js,.ts"],
  "request": "launch",
  "skipFiles": ["<node_internals>/**"],
  "type": "node"
}
```

VSCode Debugger å¯¹ npm scripts è°ƒè¯•çš„åœºæ™¯åšäº†å°è£…ï¼Œè¿˜å¯ä»¥é€‰æ‹© node çš„ Launch via npmï¼Œç›´æ¥æŒ‡å®šè¿è¡Œçš„å‘½ä»¤å³å¯ï¼š

```json
{
  "name": "Launch via NPM",
  "request": "launch",
  "runtimeArgs": ["run-script", "debug"],
  "runtimeExecutable": "npm",
  "skipFiles": ["<node_internals>/**"],
  "type": "node"
}
```

### 3.5 è°ƒè¯•å‘½ä»¤è¡Œå·¥å…·

webpackã€viteã€babelã€tscã€eslint ç­‰å„ç§å‘½ä»¤è¡Œå·¥å…·éƒ½æä¾›äº†ä¸¤ç§å…¥å£ï¼šå‘½ä»¤è¡Œå’Œ apiã€‚

å¹³æ—¶ä¼šé€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼ï¼Œæ¯”å¦‚ eslint xxx --fix ä½¿ç”¨ï¼Œä½†æ˜¯åˆ«çš„å·¥å…·é›†æˆè¿™äº›å·¥å…·çš„æ—¶å€™å°±ä¼šä½¿ç”¨ api äº†ï¼Œå®ƒæ›´çµæ´»ã€‚æ‰€ä»¥ï¼Œè°ƒè¯•è¿™äº›å·¥å…·çš„æ—¶å€™ä¹Ÿå°±æœ‰ä¸¤ç§æ–¹å¼ï¼Œé€šè¿‡å‘½ä»¤è¡Œè°ƒè¯•å’Œé€šè¿‡ api è°ƒè¯•ã€‚

**å‘½ä»¤è¡Œçš„æ–¹å¼è°ƒè¯• ESLint æºç **
åˆ›å»ºä¸€ä¸ª js æ–‡ä»¶ï¼Œéšä¾¿å†™å‡ ä¸ªæ ¼å¼é”™è¯¯ï¼Œå®‰è£… eslint åé…ç½®ä¸‹ .eslintrc.jsã€‚æ‰§è¡Œ `npx eslint ./*.js` å°±ä¼šçœ‹åˆ°å‡ ä¸ªæ ¼å¼é”™è¯¯ï¼Œæ‰§è¡Œ `npx eslint ./*.js --fix` å°±ä¼šè‡ªåŠ¨ä¿®å¤é”™è¯¯ã€‚

æƒ³æ¢ç©¶ä¸‹ fix çš„åŸç†ï¼Œå°±è¦è°ƒè¯•ä¸‹æºç äº†ã€‚ç”¨å‘½ä»¤è¡Œçš„æ–¹å¼è°ƒè¯•çš„è¯ï¼Œå°±è¦æ·»åŠ ä¸€ä¸ªè¿™æ ·çš„è°ƒè¯•é…ç½®ï¼š

```json
{
  "name": "eslint è°ƒè¯•",
  "program": "${workspaceFolder}/node_modules/.bin/eslint",
  "args": ["./index.js", "--fix"],
  "skipFiles": ["<node_internals>/**"],
  "cwd": "${workspaceFolder}",
  "request": "launch",
  "type": "node"
}
```

**api çš„æ–¹å¼è°ƒè¯• ESLint æºç **
é€šè¿‡å‘½ä»¤è¡Œçš„æ–¹å¼è°ƒè¯• ESLint æºç çš„æ—¶å€™ï¼ŒçŸ¥é“äº† ESLint ä¼šåˆ›å»º ESLint å®ä¾‹ï¼Œç„¶åè°ƒç”¨ lintText æ–¹æ³•æ¥å¯¹ä»£ç  lintã€‚

```js
const { ESLint } = require('eslint');

const engine = new ESLint({
  fix: false
});

(async function main() {
  const results = await engine.lintText(`
    function add (a, b)
{
  return a + b
}
  `);

  console.log(results[0].output);

  const formatter = await engine.loadFormatter('stylish');
  const resultText = formatter.format(results);
  console.log(resultText);
})();
```

é¦–å…ˆç›´æ¥ node æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°æ‰“å°å‡ºçš„é”™è¯¯å’Œç”¨å‘½ä»¤è¡Œçš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œç„¶ååˆ›å»ºä¸ª debug é…ç½®æ¥è·‘ï¼š

```json
{
  "name": "è°ƒè¯• eslint api",
  "program": "${workspaceFolder}/api-test.js",
  "request": "launch",
  "skipFiles": ["<node_internals>/**"],
  "console": "integratedTerminal",
  "type": "node"
}
```

å¯ä»¥ç›´æ¥ä»å®ç° lint çš„éƒ¨åˆ†å¼€å§‹è°ƒè¯•ï¼Œè·³è¿‡äº†å‰é¢å‘½ä»¤è¡Œå‚æ•°è§£æçš„éƒ¨åˆ†ï¼Œè¿™æ ·æ›´æœ‰é’ˆå¯¹æ€§ã€‚

## å››. è¿œç¨‹è°ƒè¯•ç§»åŠ¨ç«¯

### 4.1 è¿œç¨‹è°ƒè¯• android ç½‘é¡µ

1. ç”¨æ•°æ®çº¿æŠŠå®‰å“æ‰‹æœºå’Œç”µè„‘è¿æ¥èµ·æ¥ï¼Œåœ¨æ‰‹æœºè®¾ç½®é‡Œæ‰“å¼€ USB è°ƒè¯•ã€‚
2. ç„¶ååœ¨ chrome æ‰“å¼€ chrome://inspect/#devicesï¼Œå‹¾é€‰ Discover USB devicesï¼ˆé»˜è®¤æ˜¯å‹¾é€‰çš„ï¼‰ã€‚
3. åœ¨æ‰‹æœºä¸Šå…è®¸ USB è°ƒè¯•åï¼Œä¼šåœ¨é…ç½®çš„ä¸‹æ–¹åˆ—å‡ºæ‰€æœ‰å¯ä»¥è°ƒè¯•çš„ç½‘é¡µï¼š

   ![å¯è°ƒè¯•ç½‘é¡µ.webp](./image/%E5%8F%AF%E8%B0%83%E8%AF%95%E7%BD%91%E9%A1%B5.webp)

   æµè§ˆå™¨é‡Œçš„ç½‘é¡µã€App è°ƒè¯•åŒ…çš„ webview çš„ç½‘é¡µã€æµè§ˆå™¨æ‰©å±•çš„ frontend éƒ½ä¼šåˆ—å‡ºæ¥ã€‚

4. ç‚¹å‡»ç½‘é¡µä¸‹æ–¹ inspect å°±å¯ä»¥è°ƒè¯•äº†ï¼Œå„ç§è°ƒè¯• PC ç½‘é¡µçš„åŠŸèƒ½åŸºæœ¬éƒ½æ”¯æŒã€‚

å¦‚æœé‡åˆ°æ‰“å¼€çš„çª—å£æ˜¯ç©ºç™½çš„æˆ–è€…æ˜¯ 404ï¼Œè¿™æ˜¯å› ä¸ºè°ƒè¯•çš„ç›®æ ‡å¯èƒ½æ˜¯ä»»æ„ chrome ç‰ˆæœ¬ï¼Œé‚£ä¹ˆ Chrome DevTools è‡ªç„¶ä¹Ÿè¦ç”¨ç›¸åº”çš„ç‰ˆæœ¬æ‰è¡Œï¼Œæ‰€ä»¥å°±éœ€è¦åŠ¨æ€ä¸‹è½½ã€‚è€ŒåŠ¨æ€ä¸‹è½½çš„ devtools ç½‘é¡µæ˜¯åœ¨ google åŸŸåä¸‹çš„ï¼Œéœ€è¦ç§‘å­¦ä¸Šç½‘æ‰è¡Œã€‚

Android ä¸‹å¯ä»¥åœ¨å¼€å‘è€…é€‰é¡¹é‡Œæ‰“å¼€æ˜¾ç¤ºå¸ƒå±€è¾¹ç•Œï¼Œå¦‚æœæ˜¯åŸç”Ÿçš„ç»„ä»¶ï¼Œå°±ä¼šæ˜¾ç¤ºè¾¹æ¡†ï¼Œè€Œæ²¡æœ‰è¾¹æ¡†çš„ï¼Œå°±æ˜¯ç½‘é¡µã€‚

### 4.2 è¿œç¨‹è°ƒè¯• ios ç½‘é¡µ

## äº”. Charles è°ƒè¯•

Charles æ˜¯åœ¨ PC ç«¯å¸¸ç”¨çš„ç½‘ç»œå°åŒ…æˆªå–å·¥å…·ï¼Œåœ¨åšç§»åŠ¨å¼€å‘æ—¶ï¼Œä¸ºäº†è°ƒè¯•ä¸æœåŠ¡å™¨ç«¯çš„ç½‘ç»œé€šè®¯åè®®ï¼Œå¸¸å¸¸éœ€è¦æˆªå–ç½‘ç»œå°åŒ…æ¥åˆ†æã€‚é™¤äº†åœ¨åšç§»åŠ¨å¼€å‘ä¸­è°ƒè¯•ç«¯å£å¤–ï¼ŒCharles ä¹Ÿå¯ä»¥ç”¨äºåˆ†æç¬¬ä¸‰æ–¹åº”ç”¨çš„é€šè®¯åè®®ã€‚é…åˆ Charles çš„ SSL åŠŸèƒ½ï¼ŒCharles è¿˜å¯ä»¥åˆ†æ Https åè®®ã€‚

Charles é€šè¿‡å°†è‡ªå·±è®¾ç½®æˆç³»ç»Ÿçš„ç½‘ç»œè®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œä½¿å¾—æ‰€æœ‰çš„ç½‘ç»œè®¿é—®è¯·æ±‚éƒ½é€šè¿‡å®ƒæ¥å®Œæˆï¼Œä»è€Œå®ç°äº†ç½‘ç»œå°åŒ…çš„æˆªå–å’Œåˆ†æã€‚

### 5.1 æ–­ç‚¹è°ƒè¯• https è¯·æ±‚

å®‰è£… [Charles](https://www.charlesproxy.com/download/latest-release/) åï¼Œå·¦ä¸Šè§’çš„ start recording æ˜¯é»˜è®¤æ‰“å¼€çš„ã€‚

æµè§ˆå™¨è®¿é—®ä¸€äº›é¡µé¢ï¼Œè¿™æ—¶å€™å·¦ä¾§å°±ä¼šå±•ç¤ºå‡ºæŠ“åˆ°çš„ http/https è¯·æ±‚ï¼š

![Charles-httpsè¯·æ±‚åˆ—è¡¨](./image/Charles-https%E8%AF%B7%E6%B1%82%E5%88%97%E8%A1%A8.webp)
